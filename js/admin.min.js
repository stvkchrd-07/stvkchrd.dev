let supabaseClient;document.addEventListener('DOMContentLoaded',()=>{if(!window.env||!window.env.SUPABASE_URL||!window.env.SUPABASE_ANON_KEY){console.error('Error: Supabase environment variables are not set. Cannot load admin panel.'),alert('Configuration error. Please check the console.');return}const{createClient:e}=window.supabase;supabaseClient=e(window.env.SUPABASE_URL,window.env.SUPABASE_ANON_KEY),loadProjects(),loadBlogPosts();document.getElementById('add-project-form').addEventListener('submit',handleAddProject),document.getElementById('add-blog-form').addEventListener('submit',handleAddBlogPost)});async function loadProjects(){if(!supabaseClient)return;const{data:e,error:t}=await supabaseClient.from('projects').select('*').order('id',{ascending:!1});if(t){console.error('Error fetching projects:',t);return}const o=document.getElementById('existing-projects-list');if(o.innerHTML='',!e||0===e.length){o.innerHTML='<p>No projects found. Add one using the form above.</p>';return}e.forEach(e=>{const t=document.createElement('div');t.className='border-2 border-black p-4 bg-white flex justify-between items-center',t.innerHTML=`
            <div>
                <h4 class="font-bold text-xl">${e.title}</h4>
                <p>${e.subtitle}</p>
            </div>
            <div>
                <button class="underline text-red-600" onclick="deleteProject(${e.id})">Delete</button>
            </div>
        `,o.appendChild(t)})}async function handleAddProject(e){if(e.preventDefault(),!supabaseClient)return;const t={title:document.getElementById('project-title').value,subtitle:document.getElementById('project-subtitle').value,description:document.getElementById('project-description').value,imageUrl:document.getElementById('project-image-url').value,liveUrl:document.getElementById('project-live-url').value},o=await supabaseClient.from('projects').insert([t]);o.error?(console.error('Error adding project:',o.error),alert('Error: Could not add project.')):(e.target.reset(),loadProjects())}async function deleteProject(e){if(confirm('Are you sure you want to delete this project?')){if(!supabaseClient)return;const t=await supabaseClient.from('projects').delete().match({id:e});t.error?(console.error('Error deleting project:',t.error),alert('Error: Could not delete project.')):loadProjects()}}async function loadBlogPosts(){if(!supabaseClient)return;const{data:e,error:t}=await supabaseClient.from('posts').select('*').order('date',{ascending:!1});if(t){console.error('Error fetching posts:',t);return}const o=document.getElementById('existing-posts-list');if(o.innerHTML='',!e||0===e.length){o.innerHTML='<p>No blog posts found. Add one using the form above.</p>';return}e.forEach(e=>{const t=document.createElement('div');t.className='border-2 border-black p-4 bg-white flex justify-between items-center',t.innerHTML=`
            <div>
                <h4 class="font-bold text-xl">${e.title}</h4>
                <p>${new Date(e.date).toLocaleDateString()}</p>
            </div>
            <div>
                <button class="underline text-red-600" onclick="deletePost(${e.id})">Delete</button>
            </div>
        `,o.appendChild(t)})}async function handleAddBlogPost(e){if(e.preventDefault(),!supabaseClient)return;const t={title:document.getElementById('blog-title').value,date:document.getElementById('blog-date').value,content:document.getElementById('blog-content').value},o=await supabaseClient.from('posts').insert([t]);o.error?(console.error('Error adding post:',o.error),alert('Error: Could not add post.')):(e.target.reset(),loadBlogPosts())}async function deletePost(e){if(confirm('Are you sure you want to delete this post?')){if(!supabaseClient)return;const t=await supabaseClient.from('posts').delete().match({id:e});t.error?(console.error('Error deleting post:',t.error),alert('Error: Could not delete post.')):loadBlogPosts()}}