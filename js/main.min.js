let supabaseClient,particlesMaterial,particleColorAnimationCounter=0;function getParticleCssColor(){return getComputedStyle(document.body).getPropertyValue('--particle-color-value').trim()}function animateParticleColorTo(e,t=300){if(!particlesMaterial||!e)return;const n=new THREE.Color(e),o=particlesMaterial.color.clone(),r=performance.now(),a=++particleColorAnimationCounter,i=new THREE.Color;function l(e){if(a!==particleColorAnimationCounter)return;const c=Math.min(1,(e-r)/t);i.copy(o).lerp(n,c),particlesMaterial.color.set(i),c<1&&requestAnimationFrame(l)}requestAnimationFrame(l)}function applyTheme(e){document.body.classList.toggle('dark','dark'===e),particlesMaterial&&animateParticleColorTo(getParticleCssColor(),350)}function toggleTheme(){const e=localStorage.getItem('theme')||'light',t='dark'===e?'light':'dark';localStorage.setItem('theme',t),applyTheme(t)}document.addEventListener('DOMContentLoaded',()=>{const e=document.getElementById('theme-toggle');e&&e.addEventListener('click',toggleTheme),window.env&&window.env.SUPABASE_URL&&window.env.SUPABASE_ANON_KEY||(console.warn('Supabase environment variables are not set. Skipping project load.'),(document.querySelector('#projects .grid')||{}).innerHTML='<p class="text-red-600">Could not connect to the database. Configuration is missing.</p>';return);const{createClient:t}=window.supabase;supabaseClient=t(window.env.SUPABASE_URL,window.env.SUPABASE_ANON_KEY),loadPublicProjects(),initializeThreeJS();const n=localStorage.getItem('theme')||'light';applyTheme(n)});async function loadPublicProjects(){if(!supabaseClient)return;const{data:e,error:t}=await supabaseClient.from('projects').select('*').order('id',{ascending:!1});if(t){console.error('Error fetching projects:',t);return}const n=document.querySelector('#projects .grid');if(!n)return;n.innerHTML='',e.forEach(e=>{const t=document.createElement('div');t.className='brutalist-hover border-2 border-black p-6 bg-white/80 backdrop-blur-sm',t.innerHTML=`
            <h3 class="font-black text-2xl md:text-3xl">${e.title}</h3>
            <p class="mt-1 text-base">${e.subtitle}</p>
        `,t.onclick=(()=>openModal(e.title,e.description,e.imageUrl,e.liveUrl)),n.appendChild(t)})}const loaderText=document.getElementById('loader-text'),loaderBar=document.getElementById('loader-bar'),loaderContainer=document.getElementById('loader');if(loaderContainer){let e=0;const t=setInterval(()=>{e+=1,loaderText&&(loaderText.textContent=`${e}%`),loaderBar&&(loaderBar.style.width=`${e}%`),e>=100&&(clearInterval(t),setTimeout(()=>{loaderContainer.style.display='none'},500))},10)}const modal=document.getElementById('project-modal'),modalTitle=document.getElementById('modal-title'),modalDescription=document.getElementById('modal-description'),modalImage=document.getElementById('modal-image'),modalLink=document.getElementById('modal-link');function openModal(e,t,n,o){if(!modal)return;modalTitle.textContent=e,modalDescription.textContent=t,modalImage.src=n,modalLink.href=o,modal.style.display='block'}function closeModal(){modal&&(modal.style.display='none')}window.onclick=function(e){e.target==modal&&closeModal()};function copyEmailToClipboard(e){const t=document.createElement('textarea');t.value=e,t.style.position='fixed',document.body.appendChild(t),t.focus(),t.select();try{document.execCommand('copy');const t=document.getElementById('copy-toast');t&&(t.textContent=`${e} copied to clipboard`,t.classList.add('show'),setTimeout(()=>{t.classList.remove('show')},800))}catch(e){console.error('Fallback: Oops, unable to copy',e)}document.body.removeChild(t)}function initializeThreeJS(){const e=document.getElementById('bg-canvas');if(e){const t=new THREE.Scene,n=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);n.position.z=10;const o=new THREE.WebGLRenderer({canvas:e,alpha:!0,antialias:!0});o.setSize(window.innerWidth,window.innerHeight),o.setPixelRatio(Math.min(window.devicePixelRatio,2));const r=2e3,a=new Float32Array(3*r);for(let e=0;e<3*r;e++)a[e]=(Math.random()-.5)*20;const i=new THREE.BufferGeometry;i.setAttribute('position',new THREE.BufferAttribute(a,3)),particlesMaterial=new THREE.PointsMaterial({size:.02,sizeAttenuation:!0});const l=getParticleCssColor();l&&particlesMaterial.color.set(l);const c=new THREE.Points(i,particlesMaterial);t.add(c);const d=new THREE.Vector2;window.addEventListener('mousemove',e=>{d.x=e.clientX/window.innerWidth*2-1,d.y=-(e.clientY/window.innerHeight)*2+1},{passive:!0});const s=new THREE.Clock,u=()=>{const e=s.getElapsedTime();c.rotation.y=-.04*e,c.rotation.x=-.04*e,0!==d.x&&0!==d.y&&(c.rotation.y+=(.2*d.x-c.rotation.y)*.01,c.rotation.x+=(.2*d.y-c.rotation.x)*.01),o.render(t,n),window.requestAnimationFrame(u)};window.addEventListener('resize',()=>{n.aspect=window.innerWidth/window.innerHeight,n.updateProjectionMatrix(),o.setSize(window.innerWidth,window.innerHeight),o.setPixelRatio(Math.min(window.devicePixelRatio,2))},{passive:!0}),u()}}